<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Калькулятор електричних навантажень (метод УД)</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; }
    table, th, td { border: 1px solid black; border-collapse: collapse; padding: 5px; }
    table { margin-bottom: 20px; width: 100%; }
    input[type="number"] { width: 80px; }
    th { background-color: #f0f0f0; }
  </style>
</head>
<body>
  <h1>Калькулятор електричних навантажень (метод упорядкованих діаграм)</h1>

  <table id="epTable">
    <thead>
      <tr>
        <th>Назва ЕП</th>
        <th>n</th>
        <th>Pн (кВт)</th>
        <th>ηн</th>
        <th>cos φ</th>
        <th>Uн (кВ)</th>
        <th>Kв</th>
        <th>tg φ</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>Шліфувальний верстат</td><td><input value="4"></td><td><input value="20"></td><td><input value="0.92"></td><td><input value="0.9"></td><td><input value="0.38"></td><td><input value="0.15"></td><td><input value="1.33"></td></tr>
      <tr><td>Свердлильний верстат</td><td><input value="2"></td><td><input value="14"></td><td><input value="0.92"></td><td><input value="0.9"></td><td><input value="0.38"></td><td><input value="0.12"></td><td><input value="1"></td></tr>
      <tr><td>Фугувальний верстат</td><td><input value="4"></td><td><input value="42"></td><td><input value="0.92"></td><td><input value="0.9"></td><td><input value="0.38"></td><td><input value="0.15"></td><td><input value="1.33"></td></tr>
      <tr><td>Циркулярна пила</td><td><input value="1"></td><td><input value="36"></td><td><input value="0.92"></td><td><input value="0.9"></td><td><input value="0.38"></td><td><input value="0.3"></td><td><input value="1.52"></td></tr>
      <tr><td>Прес</td><td><input value="1"></td><td><input value="20"></td><td><input value="0.92"></td><td><input value="0.9"></td><td><input value="0.38"></td><td><input value="0.5"></td><td><input value="0.75"></td></tr>
      <tr><td>Полірувальний верстат</td><td><input value="1"></td><td><input value="40"></td><td><input value="0.92"></td><td><input value="0.9"></td><td><input value="0.38"></td><td><input value="0.2"></td><td><input value="1"></td></tr>
      <tr><td>Фрезерний верстат</td><td><input value="2"></td><td><input value="32"></td><td><input value="0.92"></td><td><input value="0.9"></td><td><input value="0.38"></td><td><input value="0.2"></td><td><input value="1"></td></tr>
      <tr><td>Вентилятор</td><td><input value="1"></td><td><input value="20"></td><td><input value="0.92"></td><td><input value="0.9"></td><td><input value="0.38"></td><td><input value="0.65"></td><td><input value="0.75"></td></tr>
    </tbody>
  </table>

  <button onclick="calculate()">Розрахувати</button>

  <div id="result"></div>

  <script>
    const kpTable = {
      "0.20": {"15": 1.25},
      "0.32": {"56": 0.70}
    };

    function findKp(kv, ne) {
      const kvKeys = Object.keys(kpTable);
      const kvNearest = kvKeys.reduce((a, b) => Math.abs(kv - a) < Math.abs(kv - b) ? a : b);
      const neKeys = Object.keys(kpTable[kvNearest]);
      const neNearest = neKeys.reduce((a, b) => Math.abs(ne - a) < Math.abs(ne - b) ? a : b);
      return kpTable[kvNearest][neNearest];
    }

    function calculate() {
      const rows = document.querySelectorAll("#epTable tbody tr");
      let Psum = 0, Pkvsum = 0, PkvTgSum = 0, P2sum = 0;
      let U = parseFloat(rows[0].cells[5].querySelector("input").value) * 1000;

      rows.forEach(row => {
        const n = parseFloat(row.cells[1].querySelector("input").value);
        const Pn = parseFloat(row.cells[2].querySelector("input").value);
        const kv = parseFloat(row.cells[6].querySelector("input").value);
        const tg = parseFloat(row.cells[7].querySelector("input").value);

        const P = n * Pn;
        Psum += P;
        Pkvsum += P * kv;
        PkvTgSum += P * kv * tg;
        P2sum += n * Pn * Pn;
      });

      const Kv = Pkvsum / Psum;
      const ne = Math.round(Psum * Psum / P2sum);
      const Kp = findKp(Kv.toFixed(2), ne);
      const Pp = Kp * Pkvsum;
      const Qp = Kp * PkvTgSum;
      const Sp = Math.sqrt(Pp ** 2 + Qp ** 2);
      const Ip = Sp * 1000 / (Math.sqrt(3) * U);

      document.getElementById("result").innerHTML = `
        <h3>Результати:</h3>
        <p>Kв = ${Kv.toFixed(4)}<br>
        ne = ${ne}<br>
        Kр = ${Kp}<br>
        Pp = ${Pp.toFixed(2)} кВт<br>
        Qp = ${Qp.toFixed(2)} квар<br>
        Sp = ${Sp.toFixed(4)} кВА<br>
        Ip = ${Ip.toFixed(2)} A</p>`;
    }
  </script>
</body>
</html>
